<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>
  <meta charset="utf-8"/>
  <title>Мой аккаунт</title>
  <link href="https://fonts.googleapis.com/css2?family=Averia+Serif+Libre&display=swap" rel="stylesheet"><!-- ссылка на шрифт -->
  <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"> -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
  <script type="text/javascript" th:src="@{/js/common.js}"></script>
  <link media="all" rel="stylesheet" type="text/css" th:href="@{/css/style_user-edit.css}">
</head>

<body>
<div>
  <a th:href="@{/bikes}">[На главную]</a>
</div>

<!--этот блок есть во всех страницах, кроме login-->
<!--это куда-нибудь в правый угол; положение - горизонтально-->
<!--надо сделать что-то типа dropdown из bootstrap: чтоб из имени юзера выпадала менюшка-->
<div>
  <form th:action="@{/logout}" method="post" th:hidden="true" name="logoutForm">
    <input type="submit"/>
  </form>

  <div>
    <span class="fas fa-light fa-user fa-2x"></span>
  </div>
  <div>
    <a data-toggle="dropdown"
       sec:authentication="principal.username"></a>
    <div>
      <a th:href="@{/users}">Пользователи</a>
    </div>
    <div>
      <a id="logoutLink" th:href="@{/logout}">Выйти</a>
    </div>
  </div>
</div>

<h1  th:text="${'Мой аккаунт'}"/></h1>

<!--Сообщение об успешном добавлении/изменении/удалении-->
<div class="alert" th:if="${message != null}">
  [[${message}]]
</div>

<div class="container">
  <form th:action="@{/account/save}"
        th:object="${user}" method="post" class="form-vertical">

    <input type="hidden" th:field="*{id}"/>
    <div  class="input-group inp">
      <label>Логин</label>
      <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
      <input th:field="*{username}" placeholder="Логин" class="form-control form" readonly="readonly"/>
    </div>

    <div  class="input-group inp">
      <label>Пароль</label>
      <div>
        <input type="password" th:field="*{password}" placeholder="Ничего не вводите, если не хотите изменить"
               oninput="checkPasswordMatch(document.getElementById('confirmPassword'))"/>
      </div>
    </div>

    <div  class="input-group inp">
      <label>Повторите новый пароль</label>
      <div>
        <input type="password" id="confirmPassword" oninput="checkPasswordMatch(this)"/>
      </div>
    </div>

    <div class="input-group inp">
      <label>Имя</label>
      <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
      <input th:field="*{firstName}" placeholder="Имя (необязательно)" class="form-control form"/>
    </div>

    <div class="input-group inp">
      <label>Фамилия</label>
      <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
      <input th:field="*{lastName}" placeholder="Фамилия (необязательно)" class="form-control form"/>
    </div>

    <div  class="input-group">
      <label class="input-group-addon"><i class="glyphicon glyphicon-user">Мои роли:</i></label>
      <span>[[${user.roles}]]</span>
    </div>

    <div class="form-group button">
      <div>
        <button type="submit" class="btn">Сохранить</button>
        <button  type="button" class="btn"><a  th:href="@{'/bikes'}" th:text="Отмена"/></button>
      </div>
    </div>
  </form>

  <script type="text/javascript">
    function checkPasswordMatch(confirmPassword) {
      if (confirmPassword.value != $("#password").val()) {
        confirmPassword.setCustomValidity("Пароли не совпадают");
      } else {
        confirmPassword.setCustomValidity("");
      }
    }
  </script>
</div>
</body>
</html>